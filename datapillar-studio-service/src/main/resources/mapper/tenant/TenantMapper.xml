<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sunny.datapillar.studio.module.tenant.mapper.TenantMapper">

    <select id="selectByCode" resultType="com.sunny.datapillar.studio.module.tenant.entity.Tenant">
        SELECT *
        FROM tenants
        WHERE code = #{code}
        LIMIT 1
    </select>

    <update id="updateHierarchy">
        UPDATE tenants
        SET path = REPLACE(path, #{oldPath}, #{newPath}),
            level = level + #{delta}
        WHERE path = #{oldPath}
           OR path LIKE CONCAT(#{oldPath}, /%)
    </update>

    <update id="updateEncryptPublicKey">
        UPDATE tenants
        SET encrypt_public_key = #{encryptPublicKey}
        WHERE id = #{id}
    </update>

</mapper>
